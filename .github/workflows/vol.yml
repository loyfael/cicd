name: EnquÃªte PoliciÃ¨re - SuperPrix

on:
  push:

jobs:
  policier-scene:
    name: ğŸ‘® Policier - ScÃ¨ne de crime
    runs-on: ubuntu-latest
    outputs:
      empreinte: "empreinte trouvÃ©e sur la caisse"
    steps:
      - name: ğŸ” Examen de la scÃ¨ne
        run: |
          echo "Le policier examine la caisse enregistreuse"
          echo "Empreinte prÃ©levÃ©e sur la caisse"

  policier-video:
    name: ğŸ¥ Policier - CamÃ©ras de surveillance
    runs-on: ubuntu-latest
    outputs:
      video: ${{ steps.capture.outputs.resultat }}
    steps:
      - name: ğŸ“¹ RÃ©cupÃ©ration des vidÃ©os
        id: capture
        run: echo "resultat=SÃ©quence vidÃ©o 22h15-22h45 rÃ©cupÃ©rÃ©e" >> $GITHUB_OUTPUT

  detective:
    name: ğŸ•µï¸ DÃ©tective
    runs-on: ubuntu-latest
    needs: [policier-scene, policier-video]
    outputs:
      rapport: ${{ steps.rapport_final.outputs.conclusion }}
      lieu_arrestation: ${{ steps.rapport_final.outputs.lieu }}
      autorisation_arrestation: ${{ steps.rapport_final.outputs.autorisation }}
    steps:
      - name: ğŸ“‚ Analyse des indices
        run: |
          echo "Empreinte : ${{ needs.policier-scene.outputs.empreinte }}"
          echo "VidÃ©o : ${{ needs.policier-video.outputs.video }}"

      - name: ğŸ§¬ InterprÃ©tation des indices
        run: |
          echo "ANALYSE_EMPREINTE=Empreinte correspond Ã  un suspect connu" >> $GITHUB_ENV
          echo "ANALYSE_VIDEO=Suspect identifiÃ© sur la vidÃ©o Ã  22h30" >> $GITHUB_ENV

      - name: ğŸ“ Rapport final
        id: rapport_final
        run: |
          echo "conclusion=${ANALYSE_EMPREINTE}, ${ANALYSE_VIDEO}, suspect identifiÃ©" >> $GITHUB_OUTPUT
          echo "lieu=42 Avenue du Commerce, SupermarchÃ© SuperPrix" >> $GITHUB_OUTPUT
          echo "autorisation=true" >> $GITHUB_OUTPUT

  police:
    name: ğŸš” Ã‰quipe d'intervention
    runs-on: ubuntu-latest
    needs: detective
    steps:
      - name: ğŸ—‚ï¸ Lecture du rapport
        run: |
          echo "ğŸ§¾ Rapport : ${{ needs.detective.outputs.rapport }}"
          echo "ğŸ“ Lieu : ${{ needs.detective.outputs.lieu_arrestation }}"
          echo "âœ… Autorisation : ${{ needs.detective.outputs.autorisation_arrestation }}"

      - name: ğŸš« EnquÃªte sans suite
        if: ${{ needs.detective.outputs.autorisation_arrestation != 'true' }}
        run: echo "Aucune arrestation possible. EnquÃªte classÃ©e."

      - name: ğŸ‘®â€â™‚ï¸ Arrestation en cours
        if: ${{ needs.detective.outputs.autorisation_arrestation == 'true' }}
        run: echo "Intervention au 42 Avenue du Commerce. Suspect arrÃªtÃ©."
